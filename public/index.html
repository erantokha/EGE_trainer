<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Тренажёр по формулам — Фаза 3.2 + Фаза 4</title>
  <style>
    body{background:#0f1115;color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;}
    .wrap{max-width:1100px;margin:28px auto;padding:0 16px;}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .btn, button{background:#2563eb;border:0;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}
    .btn.secondary{background:#374151}
    .bar{height:4px;background:#1f2937;border-radius:2px;overflow:hidden;margin:8px 0 18px}
    .bar>div{height:100%;background:#60a5fa;width:0%}
    .panel{background:#111827;border:1px solid #1f2937;border-radius:10px;padding:14px;margin:14px 0}
    .option{display:block;background:#0b0f14;border:1px solid #1f2937;border-radius:10px;padding:12px 12px;margin:10px 0;cursor:pointer}
    .option input{margin-right:10px}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border-top:1px solid #1f2937;padding:10px 8px;text-align:left}
    .badge{background:#0b0f14;border:1px solid #1f2937;border-radius:999px;padding:6px 10px;margin-right:6px}
    .ok{color:#22c55e} .bad{color:#ef4444}
    .hidden{display:none}
    .pill{padding:2px 8px;border-radius:999px;font-size:12px;line-height:18px}
    .pill-ok{background:#103d19;color:#7dff9b;border:1px solid #2a8f4a}
    .pill-warn{background:#3d2a10;color:#ffd27d;border:1px solid #8f6a2a}
    .pill-err{background:#3d1010;color:#ff9b9b;border:1px solid #8f2a2a}
    .pill-muted{background:#222;color:#bbb;border:1px solid #444}
    .modal{position:fixed;inset:0;display:block;background:rgba(0,0,0,.5);z-index:1000}
    .modal.hidden{display:none}
    .modal .modal-body{background:#0b0f14;border:1px solid #1f2937;border-radius:12px;padding:18px;max-width:460px;margin:10vh auto}
    label.topic{display:flex;gap:8px;align-items:center;margin:6px 0}
    .linklike{background:none;border:0;color:#6aa9ff;cursor:pointer}
    .footer{margin:28px 0 8px;opacity:.8;display:flex;gap:14px;justify-content:flex-end}
    .footer a{color:#9bbcff;text-decoration:none}
    .footer a:hover{text-decoration:underline}
  </style>
  <script>
    window.MathJax = {tex:{inlineMath:[['\\(','\\)'],['$','$']]}};
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <h1>Тренажёр по формулам — Фаза 3.2 + Фаза 4</h1>
      <div class="row">
        <button id="btnTopics" class="btn secondary">Темы</button>
        <button id="btnPause" class="btn secondary">Пауза</button>
        <button id="btnFinish" class="btn">Завершить</button>
        <span id="sendStatus" class="pill pill-muted" title="" style="margin-left:8px; display:none;">Статус</span>
        <button id="btnStudent" class="linklike" style="margin-left:12px;">Сменить ученика</button>
      </div>
    </div>

    <div class="row" style="gap:12px;margin-top:4px">
      <div>Фильтр темы: <select id="filterTopic"><option value="">Все</option></select></div>
      <div style="margin-left:auto;opacity:.75">⏱ <span id="timer">00:00.00</span></div>
    </div>

    <div class="bar"><div id="progressBar"></div></div>

    <div id="quiz" class="panel">
      <div id="qCounter" style="opacity:.7;margin-bottom:10px">Вопрос 0 / 0</div>
      <div id="stem" style="font-size:18px;margin-bottom:10px"></div>
      <div id="options"></div>
      <div class="row" style="justify-content:space-between;margin-top:8px">
        <button id="btnPrev" class="btn secondary">Назад</button>
        <div class="row">
          <button id="btnClear" class="btn secondary">Сбросить</button>
          <button id="btnNext" class="btn">Дальше</button>
        </div>
      </div>
    </div>

    <div id="summary" class="panel hidden"></div>

    <div id="topicModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="topicsTitle">
      <div class="modal-body">
        <h3 id="topicsTitle">Выберите темы</h3>
        <p style="opacity:.7;margin:0 0 6px">Можно выбрать от одной до всех тем</p>
        <div id="topics" style="max-height:40vh;overflow:auto;margin-bottom:8px"></div>
        <div id="hint" style="opacity:.7;margin-bottom:8px">Изначально ничего не выбрано</div>
        <div class="row">
          <button id="toggleAll" class="btn secondary">Выбрать все</button>
          <button id="startBtn" class="btn">Начать</button>
        </div>
      </div>
    </div>

    <div id="studentModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="studentTitle">
      <div class="modal-body">
        <h3 id="studentTitle">Данные ученика</h3>
        <label style="display:block;margin:8px 0 4px">Имя</label>
        <input id="studentName" type="text" placeholder="Иван Иванов" style="width:100%;padding:8px;border-radius:8px;border:1px solid #1f2937;background:#0f1319;color:#e5e7eb">
        <label style="display:block;margin:8px 0 4px">E-mail (опционально)</label>
        <input id="studentEmail" type="email" placeholder="name@example.com" style="width:100%;padding:8px;border-radius:8px;border:1px solid #1f2937;background:#0f1319;color:#e5e7eb">
        <div class="row" style="margin-top:12px;">
          <button id="studentSave" class="btn">Сохранить</button>
          <button id="studentCancel" class="btn secondary">Отмена</button>
        </div>
      </div>
    </div>

    <!-- footer links to student/admin -->
    <div class="footer">
      <a href="../student/" target="_blank" rel="noopener">↗ Мой прогресс</a>
      <a href="../admin/" target="_blank" rel="noopener">↗ Админка</a>
    </div>
  </div>

  <script type="module" src="./phase3_2.js"></script>
</body>
</html>
