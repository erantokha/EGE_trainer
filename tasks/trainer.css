:root{
  /* базовые значения (по умолчанию теперь СВЕТЛАЯ тема) */
  --bg:#ffffff;
  --panel:#ffffff;
  --panel-2:#e5e7eb;
  --border:#d1d5db;
  --text:#111827;
  --text-dim:#6b7280;
  --accent:#2563eb;
  --accent-2:#1d4ed8;
  --success:#059669;
  --danger:#dc2626;
  --muted:#ffffff;
  --shadow:0 8px 20px rgba(15,23,42,.12);
  --radius:12px;
  --figure-h:300px;
}

/* тёмная тема (явно) */
html[data-theme="dark"],
body[data-theme="dark"]{
  --bg:#0e1117;
  --panel:#111827;
  --panel-2:#0f1623;
  --border:#232635;
  --text:#e6e6e6;
  --text-dim:#aeb3c2;
  --accent:#3b82f6;
  --accent-2:#2563eb;
  --success:#10b981;
  --danger:#ef4444;
  --muted:#1b1d24;
  --shadow:0 8px 24px rgba(0,0,0,.25);
}

/* светлая тема (если атрибут всё же выставлен явно) */
html[data-theme="light"],
body[data-theme="light"]{
  --bg:#ffffff;
  --panel:#ffffff;
  --panel-2:#e5e7eb;
  --border:#d1d5db;
  --text:#111827;
  --text-dim:#6b7280;
  --accent:#2563eb;
  --accent-2:#1d4ed8;
  --success:#059669;
  --danger:#dc2626;
  --muted:#ffffff;
  --shadow:0 8px 20px rgba(15,23,42,.12);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans",Arial,"Apple Color Emoji","Segoe UI Emoji";
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

.hidden{display:none !important}
h1,h2{margin:0 0 10px}
h1{font-size:26px}
h2{font-size:20px}
p{margin:8px 0}

.container{
  max-width:1080px;
  margin:28px auto;
  padding:0 16px;
}

.panel{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:16px 18px;
}

/* оверлей загрузки */
#loadingOverlay{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,.94);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999;
  font-size:15px;
  color:var(--text-dim);
}

/* кнопки */
button{
  appearance:none;
  border:1px solid var(--border);
  background:var(--muted);
  color:var(--text);
  border-radius:10px;
  padding:8px 12px;
  cursor:pointer;
  transition:.12s ease-in-out;
  font:inherit;
}
button:hover{filter:brightness(1.06)}
button:disabled{opacity:.55;cursor:not-allowed}

/* опасные действия */
.btn-danger{
  background:var(--danger);
  border-color:var(--danger);
  color:#fff;
}
.btn-danger:hover{filter:brightness(1.06)}
.btn-danger:disabled{opacity:.6;cursor:not-allowed}

/* поля */
input[type="text"],input[type="number"]{
  background:var(--muted);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:10px;
  padding:8px 10px;
  outline:none;
}
input[type="number"]{
  width:36px;
  text-align:center;
  appearance:textfield;
}
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button{
  -webkit-appearance:none;
  margin:0;
}
input[type="number"]{-moz-appearance:textfield}

/* ссылки */
a{color:var(--accent);text-decoration:none}
a:hover{text-decoration:underline}



/* массовые кнопки (ряд 2) */
#picker .bulk-controls{
  display:flex;
  align-items:center;
  gap:var(--btn-gap);
  flex-wrap:wrap;
  margin:0; /* вертикальные отступы задаёт .sub-controls */
}
#picker .bulk-controls .bulk-hint{
  font-size:12px;
  color:var(--text-dim);
  margin-left:6px;
}
#picker .bulk-controls button{
  padding:6px 10px;
  font-size:13px;
  border-radius:10px;
}

/* вертикальные отступы между рядами */
#picker{
  --block-gap:18px;
  --btn-gap:8px;
  --row-gap:var(--btn-gap);
}
/* Главная ученика: 2 колонки (аккордеон + прогноз баллов) */
body[data-home-variant="student"] #picker .picker-grid{
  display:flex;
  align-items:flex-start;
  gap:16px;
}
body[data-home-variant="student"] #picker .picker-left{flex:1 1 auto; min-width:0}
body[data-home-variant="student"] #picker .picker-right{flex:0 0 260px; width:260px}
body[data-home-variant="student"] #picker .score-forecast{
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  background:rgba(148,163,184,.06);
}
body[data-home-variant="student"] #picker .score-forecast .sf-row{
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:10px;
  padding:6px 0;
}
body[data-home-variant="student"] #picker .score-forecast .sf-label{
  font-size:12px;
  color:var(--text-dim);
}
body[data-home-variant="student"] #picker .score-forecast .sf-value{
  font-size:18px;
  font-variant-numeric:tabular-nums;
}
body[data-home-variant="student"] #picker .score-forecast .sf-note{
  margin-top:6px;
  font-size:12px;
  color:var(--text-dim);
}


/* Главная ученика (десктоп): вместо текстового прогноза показываем горизонтальный "градусник" */
body[data-home-variant="student"] #picker .score-forecast .sf-row,
body[data-home-variant="student"] #picker .score-forecast .sf-note{
  display:none;
}

/* Градусник внутри правой колонки (десктоп) */
body[data-home-variant="student"] #picker .score-forecast .score-thermo-slot--desk{
  display:block;
  margin:0;
}

body[data-home-variant="student"] #picker .score-forecast .score-thermo{
  --st-h:64px;
  --st-radius:18px;
  --st-pad-x:14px;

  /* match badge tints */
  --st-gray:rgba(148,163,184,.10);
  --st-red:rgba(239,68,68,.14);
  --st-yellow:rgba(245,158,11,.16);
  --st-lime:rgba(132,204,22,.14);
  --st-green:rgba(16,185,129,.12);

  --st-track-bg:rgba(148,163,184,.06);
}

body[data-home-variant="student"] #picker .score-forecast .score-thermo__track{
  position:relative;
  height:var(--st-h);
  border:1px solid var(--border);
  border-radius:var(--st-radius);
  background:var(--st-track-bg);
  overflow:hidden;
}

body[data-home-variant="student"] #picker .score-forecast .score-thermo__fill{
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:0%;
  background:var(--st-gray);
  transition:width 220ms ease, background-color 220ms ease;
}
body[data-home-variant="student"] #picker .score-forecast .score-thermo[data-color="gray"] .score-thermo__fill{background:var(--st-gray);}
body[data-home-variant="student"] #picker .score-forecast .score-thermo[data-color="red"] .score-thermo__fill{background:var(--st-red);}
body[data-home-variant="student"] #picker .score-forecast .score-thermo[data-color="yellow"] .score-thermo__fill{background:var(--st-yellow);}
body[data-home-variant="student"] #picker .score-forecast .score-thermo[data-color="lime"] .score-thermo__fill{background:var(--st-lime);}
body[data-home-variant="student"] #picker .score-forecast .score-thermo[data-color="green"] .score-thermo__fill{background:var(--st-green);}

body[data-home-variant="student"] #picker .score-forecast .score-thermo__content{
  position:absolute;
  inset:0;
  padding:0 var(--st-pad-x);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  pointer-events:none;
}

body[data-home-variant="student"] #picker .score-forecast .score-thermo__label{
  font-size:12px;
  line-height:1.1;
  color:var(--text-dim);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width:100%;
}

body[data-home-variant="student"] #picker .score-forecast .score-thermo__values{
  display:flex;
  align-items:baseline;
  justify-content:center;
  gap:10px;
  margin-top:2px;
  font-variant-numeric:tabular-nums;
}

body[data-home-variant="student"] #picker .score-forecast .score-thermo__secondary{
  font-size:22px;
  line-height:1;
}

body[data-home-variant="student"] #picker .score-forecast .score-thermo__primary{
  font-size:14px;
  line-height:1;
  color:var(--text-dim);
  white-space:nowrap;
}

@media (max-width: 900px){
  body[data-home-variant="student"] #picker .picker-grid{flex-direction:column}
  body[data-home-variant="student"] #picker .picker-right{width:auto; flex:0 0 auto}
}

#picker .sub-controls{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
  margin-top:var(--row-gap);
}
#picker .sub-controls .sum{
  padding:6px 10px;
  border:1px dashed var(--border);
  border-radius:10px;
  background:var(--panel-2);
  white-space:nowrap;
}
#picker .accordion{
  margin-top:var(--block-gap);
}

/* верхний блок выбора (ряд 1) */
#picker .controls{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-top:8px;
  flex-wrap:wrap;
}
#picker .controls-left{
  display:flex;
  align-items:center;
  gap:6px;
  flex-wrap:wrap;
}
#picker .controls-actions-right{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:var(--btn-gap);
}
#picker .controls-actions-right button{
  min-width:132px;
  padding:6px 10px;
  font-size:13px;
  border-radius:10px;
}

@media (max-width: 640px){
  #picker .controls{
    justify-content:flex-start;
  }
  #picker .controls-actions-right{
    justify-content:flex-start;
    flex-wrap:wrap;
  }
  /* Главная ученика: 2 колонки (аккордеон + прогноз баллов) */
body[data-home-variant="student"] #picker .picker-grid{
  display:flex;
  align-items:flex-start;
  gap:16px;
}
body[data-home-variant="student"] #picker .picker-left{flex:1 1 auto; min-width:0}
body[data-home-variant="student"] #picker .picker-right{flex:0 0 260px; width:260px}
body[data-home-variant="student"] #picker .score-forecast{
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  background:rgba(148,163,184,.06);
}
body[data-home-variant="student"] #picker .score-forecast .sf-row{
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:10px;
  padding:6px 0;
}
body[data-home-variant="student"] #picker .score-forecast .sf-label{
  font-size:12px;
  color:var(--text-dim);
}
body[data-home-variant="student"] #picker .score-forecast .sf-value{
  font-size:18px;
  font-variant-numeric:tabular-nums;
}
body[data-home-variant="student"] #picker .score-forecast .sf-note{
  margin-top:6px;
  font-size:12px;
  color:var(--text-dim);
}
@media (max-width: 900px){
  body[data-home-variant="student"] #picker .picker-grid{flex-direction:column}
  body[data-home-variant="student"] #picker .picker-right{width:auto; flex:0 0 auto}
}

#picker .sub-controls{
    justify-content:flex-start;
  }
}

/* компактная кнопка (как в bulk-controls) */
.btn-compact{
  padding:6px 10px;
  font-size:13px;
  border-radius:10px;
}
/* чекбокс "Перемешать задачи" */
#picker .controls .shuffle{
  display:inline-flex;
  align-items:center;
  gap:6px;
  font-size:13px;
  color:var(--text-dim);
}
#picker .controls .shuffle input{
  margin:0;
}

/* переключатель режимов */
.mode-toggle{
  display:inline-flex;
  align-items:center;
  padding:2px;
  border-radius:999px;
  background:var(--panel-2);
  border:1px solid var(--border);
}
.mode-toggle .mode-btn{
  border:none;
  background:transparent;
  padding:6px 12px;
  border-radius:999px;
  color:var(--text-dim);
  font-size:13px;
  font-weight:500;
  box-shadow:none;
}
.mode-toggle .mode-btn:hover:not(.active){
  background:rgba(148,163,184,.12);
}
.mode-toggle .mode-btn.active{
  background:var(--accent);
  color:#fff;
  box-shadow:0 0 0 1px rgba(59,130,246,.6);
}

/* тумблер темы (стили оставляем, но сам переключатель скроем ниже) */
.theme-toggle{
  display:inline-flex;
  align-items:center;
  margin-left:8px;
}

.theme-toggle-input{
  position:absolute;
  opacity:0;
  pointer-events:none;
}

.theme-toggle-label{
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:space-between;
  width:48px;
  height:24px;
  padding:2px 4px;
  border-radius:999px;
  background:var(--panel-2);
  border:1px solid var(--border);
  box-sizing:border-box;
  transition:background-color .2s ease,border-color .2s ease;
  font-size:14px;
}

.theme-toggle-icon{
  line-height:1;
  transition:opacity .2s ease,transform .2s ease;
}

/* светлая тема – акцент на солнце */
html[data-theme="light"] .theme-toggle-icon-light,
body[data-theme="light"] .theme-toggle-icon-light{
  opacity:1;
}
html[data-theme="light"] .theme-toggle-icon-dark,
body[data-theme="light"] .theme-toggle-icon-dark{
  opacity:.4;
}

/* тёмная тема – акцент на луне */
html[data-theme="dark"] .theme-toggle-icon-light,
body[data-theme="dark"] .theme-toggle-icon-light{
  opacity:.4;
}
html[data-theme="dark"] .theme-toggle-icon-dark,
body[data-theme="dark"] .theme-toggle-icon-dark{
  opacity:1;
}

/* временно скрываем тумблер темы на всех страницах */
.theme-toggle{
  display:none !important;
}

/* аккордеон (страница выбора задач и уникальные прототипы) */
.accordion{margin-top:12px}

/* контролы на странице уникальных прототипов */
.uniq-controls{
  display:flex;
  align-items:center;
  gap:10px;
  margin:10px 0 4px;
}
.node{
  /* без разделительных линий, отступы — середина между старым и текущим */
  border-bottom:none;
  padding:12px 0;
}
.node:last-child{border-bottom:none}

.node .row{
  display:flex;
  align-items:center;
}

/* отступ между счётчиком и названием */
.node .row .countbox{margin-right:20px}
.node.section .section-title{margin-left:20px}

/* секция */
.section-title{
  background:transparent;
  border:none;
  padding:0;
  color:var(--text);
  cursor:pointer;
  text-align:left;
  flex:1 1 auto;
  min-width:0;
  white-space:normal;
}

/* заголовки разделов на главной странице — чуть крупнее и полужирные */
#accordion .section-title{
  font-size:15px;
  font-weight:600;
}

/* главная ученика: заголовок раздела по ширине текста + УП рядом с названием */
body[data-home-variant="student"] #accordion .section-title{
  flex:0 0 auto;
  width:auto;
  display:inline-flex;
  align-items:center;
  white-space:nowrap;
  max-width:100%;
  overflow:hidden;
  text-overflow:ellipsis;
}


body[data-home-variant="student"] #accordion .unique-btn{
  margin-left:5ch;
}

/* заголовки тем на странице уникальных прототипов делаем жирными */
#uniqAccordion .section-title{
  font-weight:600;
}

/* (раньше здесь был счётчик возле каждой темы на странице УП) */

/* кнопка «Уникальные прототипы» — показываем только у раскрытой секции */
.unique-btn{
  margin-left:12px;
  display:none;
}
.node.section.show-uniq .unique-btn{
  display:inline-flex;
}

.node .spacer{flex:1}

/* главная ученика: нейтральные плашки названий + отдельный бейдж "10 последних" (как в статистике) */
body[data-home-variant="student"] #accordion .node.section .section-title{margin-left:0}
body[data-home-variant="student"] #accordion .node .row .countbox{margin-right:12px}

/* главная ученика: названия тем/подтем — как у учителя (без овальных плашек) */
body[data-home-variant="student"] #accordion .node.topic .title{
  display:block;
  background:transparent;
  border:none;
  border-radius:0;
  padding:0;
  line-height:1.25;
  white-space:normal;
  overflow:visible;
}

body[data-home-variant="student"] #accordion .section-title{
  background:transparent;
  border:none;
  border-radius:0;
  padding:0;
}

/* отдельный бейдж "10 последних" — точь-в-точь как на странице статистики */
body[data-home-variant="student"] #accordion .home-last10-badge{flex:0 0 auto}
body[data-home-variant="student"] #accordion .home-topic-badge{margin-right:12px}

/* Вариант A: единая grid-сетка для строки заголовков и строк разделов,
   чтобы центры подписи и бейджа совпадали по горизонтали. */
body[data-home-variant="student"] #accordion{
  --home-countbox-w:132px;
  --home-pct-w:40px;
  --home-cov-w:60px;
  --home-cols-gap:12px;
}

/* строка первого уровня (раздел) + строка с подписями */
body[data-home-variant="student"] #accordion .node.section > .row,
body[data-home-variant="student"] #accordion .home-badges-head .row{
  display:grid;
  grid-template-columns:var(--home-countbox-w) var(--home-pct-w) var(--home-cov-w) max-content max-content 1fr;
  column-gap:var(--home-cols-gap);
  align-items:center;
}

/* фиксируем ширину countbox, чтобы заголовок и строки не "плавали" из-за авто-ширины input[type=number] */
body[data-home-variant="student"] #accordion .node.section > .row > .countbox{
  margin-right:0;
  width:var(--home-countbox-w);
}
body[data-home-variant="student"] #accordion .home-badges-head .countbox-head{
  margin-right:0;
  width:var(--home-countbox-w);
}

/* бейджи в гриде: убираем обёртку из потока layout (дети занимают колонки 2 и 3) */
body[data-home-variant="student"] #accordion .home-section-badges{
  margin-right:0;
  display:contents;
}

/* сами бейджи */
body[data-home-variant="student"] #accordion .home-section-pct{
  width:var(--home-pct-w);
  min-width:var(--home-pct-w);
  padding:4px 4px;
  gap:0;
  justify-self:center;
  box-sizing:border-box;
}
body[data-home-variant="student"] #accordion .home-section-pct .small{display:none}
body[data-home-variant="student"] #accordion .home-section-cov{
  width:var(--home-cov-w);
  min-width:var(--home-cov-w);
  padding:4px 6px;
  gap:0;
  justify-self:center;
  box-sizing:border-box;
}
body[data-home-variant="student"] #accordion .home-section-cov .small{display:none}

/* подписи над бейджами верхнего уровня (на главной ученика) */
body[data-home-variant="student"] #accordion .home-badges-head{
  padding:6px 0 2px;
}
body[data-home-variant="student"] #accordion .home-badges-head .countbox-head{
  visibility:hidden;
  pointer-events:none;
}
body[data-home-variant="student"] #accordion .home-badges-head .home-badge-label{
  font-size:11px;
  line-height:1;
  color:var(--text-dim);
  text-align:center;
  user-select:none;
  justify-self:center;
}
body[data-home-variant="student"] #accordion .home-badges-head .home-badge-label.pct{
  width:var(--home-pct-w);
  min-width:var(--home-pct-w);
}
body[data-home-variant="student"] #accordion .home-badges-head .home-badge-label.cov{
  width:var(--home-cov-w);
  min-width:var(--home-cov-w);
}
body[data-home-variant="student"] #accordion .home-badges-head .spacer{
  grid-column:4/-1;
}

/* в гриде дополнительный margin-left у заголовка раздела не нужен */
body[data-home-variant="student"] #accordion .node.section .section-title{margin-left:0}


body[data-home-variant="student"] #accordion .badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:4px 6px;
  border-radius:999px;
  border:1px solid var(--border);
  background:rgba(148,163,184,.08);
  font-size:11px;
  gap:4px;
  line-height:1;
  white-space:nowrap;
  width:80px;
  min-width:80px;
  overflow:visible;
  font-variant-numeric:tabular-nums;
}
body[data-home-variant="student"] #accordion .badge b{font-weight:600}
body[data-home-variant="student"] #accordion .badge .small{font-size:10px;color:var(--text-dim)}

body[data-home-variant="student"] #accordion .badge.gray{background:rgba(148,163,184,.10)}
body[data-home-variant="student"] #accordion .badge.green{background:rgba(16,185,129,.12)}
body[data-home-variant="student"] #accordion .badge.lime{background:rgba(132,204,22,.14)}
body[data-home-variant="student"] #accordion .badge.yellow{background:rgba(245,158,11,.16)}
body[data-home-variant="student"] #accordion .badge.red{background:rgba(239,68,68,.14)}


/* Плавное обновление цветов/цифр и скелетон, пока статистика не подгрузилась */
body[data-home-variant="student"] #accordion .badge{
  transition: background-color 120ms ease, border-color 120ms ease, opacity 120ms ease;
}

body[data-home-variant="student"].home-stats-loading #accordion .home-last10-badge{
  position:relative;
  opacity:.70;
}
body[data-home-variant="student"].home-stats-loading #accordion .home-last10-badge b,
body[data-home-variant="student"].home-stats-loading #accordion .home-last10-badge .small{
  color:transparent;
}
body[data-home-variant="student"].home-stats-loading #accordion .home-last10-badge::after{
  content:"";
  position:absolute;
  left:10px;
  right:10px;
  top:50%;
  height:10px;
  transform:translateY(-50%);
  border-radius:999px;
  background:linear-gradient(90deg, rgba(148,163,184,.10), rgba(148,163,184,.22), rgba(148,163,184,.10));
  animation:homeBadgeShimmer 1.1s ease-in-out infinite;
  pointer-events:none;
}
@keyframes homeBadgeShimmer{
  0%{opacity:.55}
  50%{opacity:1}
  100%{opacity:.55}
}

@media (max-width:640px){
  body[data-home-variant="student"] #accordion .badge{padding:4px 7px}
}

/* темы (подразделы) — убираем жирный шрифт */
.node.topic .title{
  font-weight:400;
}

/* дети */
.children{
  margin:8px 0 6px 32px;
  display:none;
}
.node.section.expanded>.children{display:block}

/* счётчики */
.countbox{
  display:flex;
  align-items:center;
  gap:6px;
}
.countbox .btn{
  width:28px;
  height:28px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border:1px solid var(--border);
  background:var(--muted);
  color:var(--text);
  border-radius:8px;
}
.countbox .btn:active{transform:translateY(1px)}

/* шапка раннера */
.run-head{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:10px;
}

.run-head .timer{
  margin-left:auto;
  background:var(--panel-2);
  border:1px solid var(--border);
  padding:6px 10px;
  border-radius:10px;
}

/* блок действий в шапке (лист задач) */
.run-head .actions{
  margin-left:auto;
  display:flex;
  gap:8px;
}

/* обёртка вопроса в режиме тестирования */
.qwrap{
  display:flex;
  gap:15px;
}
.qtext{
  flex:2;
  white-space:pre-wrap;
  overflow-wrap:anywhere;
}
.qfig{
  flex:1;
  display:flex;
  justify-content:flex-start;
  min-height:var(--figure-h);
  padding:4px;
  background:#ffffff;
  border:1px solid var(--border);
  border-radius:0;
}
.qfig img{
  max-height:calc(var(--figure-h) - 8px);
  max-width:100%;
  width:auto;
  height:auto;
  object-fit:contain;
  border:none;
  border-radius:0;
  background:transparent;
}

/* ответ */
.answer-row{
  display:flex;
  align-items:center;
  gap:8px;
  margin-top:22px;
}
.answer-row input[type="text"]{
  width:220px;
}

/* результат */
.result{
  margin-top:8px;
  padding:8px 10px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--panel-2);
}
.result.ok{
  border-color:#0ea572;
  background:rgba(16,185,129,.12);
}
.result.bad{
  border-color:#cf3d3d;
  background:rgba(239,68,68,.12);
}

/* навигация */
.nav{
  margin-top:12px;
  display:flex;
  gap:8px;
}

/* сводка */
#summary .stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:8px;
  margin-top:8px;
}
#summary .stats>div{
  background:var(--panel-2);
  border:1px solid var(--border);
  padding:10px;
  border-radius:10px;
}

/* отчёт: статистика (десктоп = полный набор, мобилка = компактный) */
#summary .stats>div.stat-compact{ display:none; }

@media (max-width: 520px){
  #summary .stats>div.stat-full{ display:none; }
  #summary .stats>div.stat-compact{ display:block; }

  /* цвет как у бейджей на главной (аккордеон) */
  #summary .stats>div.stat-score.gray{ background: rgba(148,163,184,.10); }
  #summary .stats>div.stat-score.red{ background: rgba(239,68,68,.14); }
  #summary .stats>div.stat-score.yellow{ background: rgba(245,158,11,.16); }
  #summary .stats>div.stat-score.lime{ background: rgba(132,204,22,.14); }
  #summary .stats>div.stat-score.green{ background: rgba(16,185,129,.12); }

  /* время: как green-бейдж (>=90%) */
  #summary .stats>div.stat-time{
    background: rgba(16,185,129,.12);
    border-color: var(--border);
    color: inherit;
  }
}
#summary .actions{
  margin-top:10px;
  display:flex;
  gap:8px;
}

/* небольшая подпись "Всего задач" в режиме списка */
.list-meta{
  margin:4px 0 8px;
  font-size:13px;
  color:var(--text-dim);

  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

.list-meta-right{
  display:flex;
  align-items:center;
  justify-content:flex-end;
}

.list-meta-right .timer{
  margin-left:0;
  font-variant-numeric:tabular-nums;
}

/* внутренний контейнер как в ДЗ */
.sheet-panel{
  margin-top:14px;
}
/* общий вариант — на всех страницах с раннером */
#runner{
  padding-bottom:40px;
}

/* мобильная версия */
@media (max-width:640px){
  .qwrap{flex-direction:column}
  .qfig{min-height:auto}
  input[type="number"]{width:56px}

  /* шапка выбора задач */
  #picker .controls-right{
    width:100%;
    align-items:flex-start;
  }
  #picker .controls-right .right-actions{
    align-items:flex-start;
  }

  /* аккордеон на узких экранах:
     текст раздела остаётся в одной строке со счётчиком,
     но может переноситься внутри себя на 2+ строки */
  .node .row{
    align-items:flex-start;
  }
  .node.section .section-title{
    margin-left:12px;
  }
  .node .row .countbox{
    margin-right:12px;
  }
  .unique-btn{
    margin-left:8px;
  }

  body[data-home-variant="student"] #accordion .unique-btn{
    margin-left:3ch;
  }
}

/* компактный режим строк аккордеона на десктопе (но без линий) */
@media (min-width:900px){
  /* середина между очень плотным (4px) и текущим (12px) вариантом */
  .accordion .node{
    padding:8px 0;
  }

  /* компактнее кнопки - и + */
  .accordion .countbox .btn{
    width:24px;
    height:24px;
    padding:0;
    border-radius:6px;
  }

  /* компактнее поле количества */
  .accordion .countbox input[type="number"],
  .accordion .countbox .count{
    padding:4px 6px;
    height:24px;
    font-size:13px;
  }

  /* заголовок раздела чуть мельче и плотнее по строке */
  #accordion .section-title{
    font-size:14px;
    line-height:1.2;
  }

  /* меньше зазор между счётчиком и заголовком */
  .accordion .node .row .countbox{
    margin-right:12px;
  }
}

/* ------- общие карточки задач (лист + уникальные + тест) ------- */

.uniq-list,
.task-list{
  display:flex;
  flex-direction:column;
  gap:10px;
  margin-top:8px;
}

/* сама карточка */
.ws-item,
.task-card{
  background:var(--panel-2);
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px 12px;
}

/* в светлой теме фон карточки делаем белым */
html[data-theme="light"] .ws-item,
body[data-theme="light"] .ws-item,
html[data-theme="light"] .task-card,
body[data-theme="light"] .task-card{
  background:#ffffff;
}

/* "номер" задачи / прототипа */
.ws-num,
.task-num{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:3px 8px;
  border-radius:6px;
  border:2px solid var(--border);
  font-weight:600;
  font-size:13px;
  margin-bottom:4px;
}

/* подсветка номера задачи в итоговом экране ДЗ */
.task-num.ok{ border-color:#166534; }
.task-num.bad{ border-color:#b91c1c; }

/* текст условия */
.ws-stem,
.task-stem{
  margin-top:2px;
  overflow-wrap:anywhere;
}

/* ответ */
.ws-ans,
.task-ans{
  margin-top:6px;
}

.ws-ans summary,
.task-ans summary{
  cursor:pointer;
}

/* картинка в карточке (лист задач, уникальные, тест) */
.ws-fig,
.task-fig{
  margin:15px 0 6px;
  padding:4px;
  background:#ffffff;
  border:1px solid var(--border);
  border-radius:0;
}

.ws-fig img,
.task-fig img{
  max-width:100%;
  max-height:260px;
  object-fit:contain;
  display:block;
  border:none;
  border-radius:0;
  background:transparent;
}

/* в светлой теме делаем фон/рамку вокруг картинок более лёгкими */
html[data-theme="light"] .ws-fig,
body[data-theme="light"] .ws-fig,
html[data-theme="light"] .task-fig,
body[data-theme="light"] .task-fig{
  border:none;
  background:transparent;
  padding:0;
}

/* одиночная карточка вопроса в режиме тестирования */
.q-card{
  margin-top:8px;
}

/* фикс для SVG-рендера MathJax, чтобы корень не обрезался */
mjx-container[jax="SVG"] > svg{
  overflow:visible;
}

/* общие ограничения для формул, чтобы не вылезали за панель */
mjx-container{
  max-width:100%;
  overflow-x:auto;
}

/* фокус */
button:focus,
input:focus{
  outline:2px solid rgba(59,130,246,.35);
  outline-offset:2px;
}

/* главная ученика: окантовка только при наведении, а фокус-обводка — только для клавиатуры */
body[data-home-variant="student"] button:focus{
  outline:none;
}
body[data-home-variant="student"] button:focus-visible{
  outline:2px solid rgba(59,130,246,.35);
  outline-offset:2px;
}
body[data-home-variant="student"] button:hover{
  outline:2px solid rgba(59,130,246,.35);
  outline-offset:2px;
}

/* главная ученика: овальная окантовка у названий тем/подтем в аккордеоне */
body[data-home-variant="student"] #accordion .section-title,
body[data-home-variant="student"] #accordion .node.topic .title{
  border-radius:9999px;
  padding-inline:0.75ch;
}
body[data-home-variant="student"] #accordion .section-title:hover,
body[data-home-variant="student"] #accordion .section-title:focus-visible{
  outline:none;
  box-shadow:0 0 0 2px rgba(59,130,246,.35);
}
body[data-home-variant="student"] #accordion .node.topic .title:hover,
body[data-home-variant="student"] #accordion .node.topic .title:focus-visible{
  box-shadow:0 0 0 2px rgba(59,130,246,.35);
}

/* hw_create: верхняя панель + авторизация */
.create-head { display:flex; justify-content:space-between; align-items:center; }
.create-head-right { display:inline-flex; align-items:center; gap:8px; flex-wrap:wrap; margin-left:auto; }


.page-head {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  flex-wrap:wrap;
}
.page-head-right {
  display:inline-flex;
  align-items:center;
  justify-content:flex-end;
  gap:8px;
  flex-wrap:wrap;
}

/* Mobile/tablet header layout: left title/content + account button pinned to the top-right.
   Keep desktop untouched by scoping to small widths. */
@media (max-width: 1024px) {
  header#appHeader.page-head{
    display:grid;
    grid-template-columns:minmax(0, 1fr) auto;
    align-items:start;
    gap:10px;
  }

  header#appHeader.page-head .page-head-left{
    min-width:0;
  }

  /* Right column stacks controls so the account stays at the very top. */
  header#appHeader.page-head .page-head-right{
    display:flex;
    flex-direction:column;
    align-items:flex-end;
    justify-content:flex-start;
    gap:6px;
    flex-wrap:nowrap;
  }

  /* Auth block ("Антон" / "Войти") should always be first. */
  header#appHeader.page-head .page-head-right .auth-mini{ order:-20; }
  header#appHeader.page-head .page-head-right > #homeBtn{ order:-10; }
  header#appHeader.page-head .page-head-right [data-header-extra="1"]{ order:0; }

  /* Prevent the account button from pushing layout on narrow screens. */
  header#appHeader.page-head .user-menu-btn{ max-width:52vw; }
  header#appHeader.page-head .user-menu-btn-label{
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
  }

  /* Ensure dropdown never goes out of the viewport. */
  header#appHeader.page-head .user-menu{
    max-width:calc(100vw - 24px);
    min-width:min(240px, calc(100vw - 24px));
    max-height:70vh;
    overflow:auto;
  }
}
.btn.small {
  padding:6px 10px;
  font-size:13px;
  border-radius:10px;
}

.added-head {
  display:flex;
  align-items:center;
  gap:10px;
}

/* hw_create: мини-карточки добавленных задач (вместо таблицы) */
.fixed-mini-list{
  display:flex;
  flex-direction:column;
  gap:10px;
}

.fixed-mini-card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px 12px;
  display:grid;
  grid-template-columns:46px 1fr 160px 44px;
  gap:10px;
  align-items:end;
}

.fixed-mini-num{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:36px;
  height:36px;
  border-radius:10px;
  border:2px solid var(--border);
  font-weight:600;
  font-size:13px;
}

.fixed-mini-field{
  display:flex;
  flex-direction:column;
  gap:4px;
  min-width:0;
}

.fixed-mini-label{
  font-size:12px;
  color:var(--text-dim);
}

.fixed-mini-del{
  height:36px;
  border-radius:12px;
  padding:0;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
  line-height:1;
}

@media (max-width: 720px){
  .fixed-mini-card{
    grid-template-columns:46px 1fr 44px;
    grid-template-areas:
      "num q del"
      "num t del";
    align-items:center;
  }
  .fixed-mini-num{ grid-area:num; }
  .fixed-mini-q{ grid-area:q; }
  .fixed-mini-t{ grid-area:t; }
  .fixed-mini-del{ grid-area:del; }
}


/* hw_create: превью‑карточки добавленных задач (номер + условие + картинка) */
.fixed-prev-card{
  align-items:flex-start;
}
.fixed-prev-card .fixed-mini-num{
  flex-shrink:0;
  margin-top:2px;
}
.fixed-prev-card .fixed-mini-del{
  flex-shrink:0;
  align-self:flex-start;
}
.fixed-prev-card .fixed-prev-body{
  min-width:0;
}

.icon-btn {
  width:36px;
  min-width:36px;
  height:36px;
  /* центр символа примерно на 45% высоты (т.е. отступ от низа ~55%) */
  padding:0 0 4px 0;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius:12px;
  border:1px solid var(--border);
  background:var(--card, var(--panel));
  cursor:pointer;
  font-size:22px;
  line-height:1;
  text-align:center;
}
.icon-btn:hover { background:rgba(0,0,0,.03); }


.auth-mini { display:inline-flex; align-items:center; gap:8px; flex-wrap:wrap; position:relative; }
/* Кнопка "На главную": на десктопе остаётся текстовой, на мобилке превращается в иконку справа от "Антон". */
.home-icon-btn{ display:inline-flex; align-items:center; gap:6px; }
.home-icon-btn .home-icon-img{ display:none; width:18px; height:18px; }
.home-icon-btn .home-icon-label{ display:inline; }

@media (max-width: 1024px) {
  header#appHeader.page-head .page-head-right .auth-mini{
    flex-wrap:nowrap;
    gap:6px;
  }

  header#appHeader.page-head .home-icon-btn{
    width:clamp(30px, 8vw, 36px);
    height:clamp(30px, 8vw, 36px);
    padding:0;
    border:none;
    background:transparent;
    box-shadow:none;
    border-radius:999px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
  }
  header#appHeader.page-head .home-icon-btn:hover{ background:transparent; }
  header#appHeader.page-head .home-icon-btn:focus-visible{
    outline:none;
    box-shadow:0 0 0 2px rgba(59,130,246,.35);
  }

  header#appHeader.page-head .home-icon-btn .home-icon-img{ display:block; width:100%; height:100%; }
  header#appHeader.page-head .home-icon-btn .home-icon-label{ display:none; }
}

.auth-email { opacity:.85; }

.editable-wrap { display:flex; flex-direction:column; gap:6px; }
.editable-btn {
  width:100%;
  text-align:left;
  padding:10px 12px;
  border:1px dashed var(--border);
  border-radius:12px;
  background:transparent;
}
.editable-btn:hover { background:rgba(148,163,184,.12); }
.editable-muted { opacity:.85; }

.link-box {
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
  padding:10px 12px;
  border:1px solid var(--border);
  border-radius:12px;
  background:var(--panel-2);
}
.link-box .link-label { opacity:.85; }
.link-box .link-meta { opacity:.75; font-size:12px; }

.tiny-btn { padding:4px 8px; font-size:12px; border-radius:10px; }

.topic-auto { opacity:.85; }

/* ---------- modal task picker (hw_create) ---------- */
.modal {
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.modal-backdrop {
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.35);
}
.modal-card {
  position:relative;
  width:min(980px, calc(100vw - 24px));
  max-height:calc(100vh - 24px);
  overflow:hidden;
  border-radius:16px;
  border:1px solid var(--border);
  background:var(--card);
  box-shadow:0 20px 50px rgba(0,0,0,.22);
  display:flex;
  flex-direction:column;
  min-height:320px;
}
.modal-head {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:12px 14px;
  border-bottom:1px solid var(--border);
  background:var(--panel-2);
}
.modal-title { font-size:16px; }


/* hw_create: кнопка закрытия окна добавления задач */
#taskPickerModal #tpClose{
  width:36px;
  height:36px;
  /* центр символа примерно на 45% высоты (т.е. отступ от низа ~55%) */
  padding:0 0 4px 0;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  line-height:1;
  text-align:center;
}
.modal-body {
  display:grid;
  grid-template-columns:320px 1fr;
  min-height:0;
  flex:1;
}

.tp-nav {
  overflow:auto;
  padding:10px;
  border-right:1px solid var(--border);
  background:var(--panel);
}

.tp-main {
  display:flex;
  flex-direction:column;
  min-height:0;
}

.tp-main-head {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:10px 12px;
  border-bottom:1px solid var(--border);
  background:var(--panel-2);
}

.tp-main-actions { display:flex; align-items:center; gap:10px; }

.tp-list {
  overflow:auto;
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.tp-item {
  display:flex;
  gap:12px;
  align-items:flex-start;
  padding:10px 12px;
  border:1px solid var(--border);
  border-radius:14px;
  background:var(--panel);
}

.tp-item-left { flex:1; min-width:0; }
.tp-item-meta { font-size:12px; opacity:.8; margin-bottom:6px; }
.tp-item-stem { font-size:14px; line-height:1.35; }

.tp-preview { display:flex; gap:10px; align-items:flex-start; }
.tp-fig {
  width:96px;
  max-width:96px;
  height:auto;
  /* без рамки/скруглений: картинка без видимого контейнера и без обрезки углов */
  border-radius:0;
  border:none;
  background:transparent;
  display:block;
}

.tp-item-right { display:flex; align-items:center; gap:8px; flex-shrink:0; }
.tp-ctr-btn {
  width:32px;
  height:32px;
  /* центр символа примерно на 45% высоты (т.е. отступ от низа ~55%) */
  padding:0 0 3px 0;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--card, var(--panel));
  cursor:pointer;
  font-size:18px;
  line-height:1;
  text-align:center;
}

.tp-ctr-btn:disabled { opacity:.5; cursor:default; }
.tp-ctr-val { min-width:20px; text-align:center; }
.tp-ctr-cap { font-size:12px; opacity:.75; }

.tp-hint { padding:0 12px 12px; }

.tp-sec summary,
.tp-topic summary {
  cursor:pointer;
  padding:6px 8px;
  border-radius:10px;
}
.tp-sec summary:hover,
.tp-topic summary:hover { background:rgba(148,163,184,.12); }

.tp-sec-body {
  padding-left:6px;
  display:flex;
  flex-direction:column;
  gap:6px;
  margin-top:6px;
}

.tp-types { padding:6px 0 6px 8px; }
.tp-types-list { display:flex; flex-direction:column; gap:6px; }
.tp-type-btn {
  text-align:left;
  padding:8px 10px;
  border:1px solid var(--border);
  border-radius:12px;
  background:var(--card);
  cursor:pointer;
}
.tp-type-btn:hover { background:rgba(148,163,184,.12); }
.tp-type-btn.active { outline:2px solid rgba(148,163,184,.35); }

@media (max-width: 860px) {
  .modal-body { grid-template-columns:1fr; }
  .tp-nav { border-right:none; border-bottom:1px solid var(--border); max-height:240px; }
}

/* ------- hw: отступы поля ответа + центрирование кнопки ------- */
.hw-panel{ padding-bottom:0; }
.hw-panel .run-body{
  display:flex;
  flex-direction:column;
  padding-bottom:24px; /* отступ снизу равен отступу над кнопкой */
}
.hw-panel .hw-answer-row{
  margin-top:18px; /* увеличенный отступ между условием и полем ответа */
}
.hw-panel .hw-answer-row input[type="text"]{
  width:220px;
}
.hw-panel .hw-bottom{
  display:flex;
  justify-content:center; /* кнопка по центру */
  margin-top:24px;        /* отступ от последней карточки до кнопки */
}

/* ------- hw: итоговый экран (статистика/отчет) ------- */
.hw-summary-head{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:12px;
}

.hw-summary-head h2{ margin:0; }

.hw-review-controls{
  display:flex;
  align-items:center;
  gap:10px;
  margin:8px 0 14px;
}

.hw-summary-head #restart{
  margin-left:auto;
  white-space:nowrap;
}

/* Отступ от условия задачи до блока "Ваш ответ" (две строки) */
.hw-review-answers{
  margin-top:1.8em;
}

/* Видео-решение в карточке итогов (ДЗ/тренировка) */
.hw-review-answers .hw-ans-line{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
/* Правое выравнивание кнопки "Видео-решение" в итогах */
.hw-review-answers .answer-row{
  display:flex;
  align-items:center;
  gap:12px;
}
.hw-review-answers .hw-ans-line > :first-child,
.hw-review-answers .answer-row > :first-child{
  flex:1 1 auto;
  min-width:0;
}
.hw-review-answers .hw-ans-line .video-solution-slot,
.hw-review-answers .answer-row .video-solution-slot{
  margin-left:auto;
  display:inline-flex;
  align-items:center;
  white-space:nowrap;
}

.video-solution-slot{ white-space:nowrap; }
.video-solution-missing{ opacity:.75; font-size:12px; }

.video-solution-btn{
  border:none;
  background:var(--accent);
  color:#fff;
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:500;
  box-shadow:0 0 0 1px rgba(59,130,246,.6);
  cursor:pointer;
  white-space:nowrap;
}
.video-solution-btn:hover{ filter:brightness(.97); }


/* контейнер для кнопок справа в строке ответа */
.hw-actions{
  display:inline-flex;
  align-items:center;
  gap:10px;
  white-space:nowrap;
}
/* переопределяем старое margin-left:auto, чтобы слот не "растягивал" контейнер */
.hw-actions .video-solution-slot{ margin-left:0 !important; }

/* Мобильная версия: в отчетах (ДЗ) кнопки под строкой "Правильный ответ" */
@media (max-width: 520px){
  /* переносим действия на строку ниже, не трогая десктоп */
  #hw .hw-review-answers .hw-ans-line{
    flex-wrap:wrap;
    align-items:flex-start;
  }
  /* текст занимает всю ширину, кнопки уходят на новую строку */
  #hw .hw-review-answers .hw-ans-line > :first-child{
    flex:1 1 100%;
  }
  /* кнопки на отдельной строке и по левому краю */
  #hw .hw-review-answers .hw-actions{
    width:100%;
    justify-content:flex-start;
    flex-wrap:wrap;
    margin-top:6px;
  }

  /* то же самое для отчёта после тренировки */
  #summary .hw-review-answers .hw-ans-line{
    flex-wrap:wrap;
    align-items:flex-start;
  }
  #summary .hw-review-answers .hw-ans-line > :first-child{
    flex:1 1 100%;
  }
  #summary .hw-review-answers .hw-actions{
    width:100%;
    justify-content:flex-start;
    flex-wrap:wrap;
    margin-top:6px;
  }

}


/* Кнопка "Решить аналог" в итогах ДЗ */
.analog-btn{
  border:none;
  background:var(--success);
  color:#fff;
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:500;
  box-shadow:0 0 0 1px rgba(5,150,105,.55);
  cursor:pointer;
  white-space:nowrap;
}
.analog-btn:hover{ filter:brightness(.97); }
.analog-btn:disabled{
  opacity:.55;
  cursor:not-allowed;
  box-shadow:none;
}


/* Модалка видео-решения (Rutube iframe) */
body.vs-modal-open{ overflow:hidden; }

.vs-modal{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:3200;
}
.vs-modal[hidden]{ display:none; }

.vs-modal-backdrop{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.38);
}

.vs-modal-card{
  position:relative;
  width:min(980px, calc(100vw - 24px));
  max-height:calc(100vh - 24px);
  overflow:hidden;
  border-radius:16px;
  border:1px solid var(--border);
  background:var(--card);
  box-shadow:0 20px 50px rgba(0,0,0,.22);
  display:flex;
  flex-direction:column;
}

.vs-modal-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:12px 14px;
  border-bottom:1px solid var(--border);
  background:var(--panel-2);
}
.vs-modal-title{ font-size:16px; }
.vs-modal-close{
  width:36px;
  height:36px;
  padding:0 0 4px 0;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  line-height:1;
  border-radius:12px;
}
.vs-modal-body{
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.vs-iframe-wrap{
  width:100%;
  aspect-ratio:16/9;
  border-radius:12px;
  overflow:hidden;
  border:1px solid var(--border);
  background:#000;
}
.vs-iframe-wrap iframe{
  width:100%;
  height:100%;
  border:0;
}

.vs-modal-foot{ opacity:.9; font-size:12px; }

/* hw_create: меню аккаунта */
.user-menu-btn{
  display: inline-flex;
  align-items: center;
  gap: 6px;
  white-space: nowrap;
}

.user-menu-btn-label{
  display: block;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.user-menu-wrap{
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.hw-bell{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  border-radius: 0;
  background: transparent;
  vertical-align: middle;
}

.hw-bell img{
  width: 100%;
  height: 100%;
  display: block;
  object-fit: contain;
}

/* fallback (если где-то остался SVG) */
.hw-bell svg{
  width: 100%;
  height: 100%;
  fill: var(--danger);
}

.hw-bell--top{
  position: static;
  transform: none;
  margin-left: 2px;
  flex: 0 0 auto;
  pointer-events: none; /* клик по иконке открывает меню как по кнопке */
}

.hw-bell--menu{
  width: 14px;
  height: 14px;
  margin-left: 10px;
}

.user-menu-item{
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.myhw-actions{
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}

.myhw-list{
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.myhw-card{
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px;
  background: rgba(148,163,184,.06);
}

.myhw-card.clickable{
  cursor: pointer;
  transition: border-color .15s ease, box-shadow .15s ease;
}

.myhw-card.clickable:hover{
  border-color: var(--accent);
  box-shadow: 0 4px 14px rgba(15,23,42,.10);
}

.myhw-card.clickable:focus-visible{
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

.myhw-row{
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 14px;
}

.myhw-left{ min-width: 0; }

.myhw-title{
  font-size: 15px;
  line-height: 1.2;
}

.myhw-meta{
  margin-top: 4px;
  font-size: 12px;
  color: var(--muted);
}

.myhw-right{
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 6px;
}

.myhw-badge{
  font-size: 12px;
  padding: 2px 10px;
  border-radius: 999px;
  border: 1px solid var(--border);
}

.myhw-badge.ok{
  border-color: rgba(34,197,94,.35);
  background: rgba(34,197,94,.12);
}

.myhw-badge.warn{
  border-color: rgba(239,68,68,.35);
  background: rgba(239,68,68,.10);
}

.myhw-submitted{
  font-size: 12px;
  color: var(--muted);
}

.myhw-actions-row{
  margin-top: 10px;
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  flex-wrap: wrap;
}



.user-menu {
  position: absolute;
  top: calc(100% + 8px);
  right: 0;
  min-width: 210px;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  box-shadow: var(--shadow);
  padding: 6px;
  z-index: 2500;
}

.user-menu-item {
  width: 100%;
  display: block;
  text-align: left;
  border: none;
  background: transparent;
  box-shadow: none;
  padding: 10px 12px;
  border-radius: 10px;
  cursor: pointer;
}

.user-menu-item:hover {
  background: rgba(148,163,184,.12);
}

.user-menu-item:active {
  background: rgba(148,163,184,.18);
}

.user-menu-sep {
  height: 1px;
  background: var(--border);
  margin: 6px 4px;
}

.user-menu-item.danger {
  color: var(--danger);
}


/* ===== Patch2: students/stats UI ===== */

.muted { color: var(--text-dim); }

/* my_students: резервируем высоту статусов, чтобы список не "прыгал" */
.students-status{
  margin-top:10px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.students-status #addStatus,
.students-status #pageStatus{
  min-height:20px;
}
.students-list{ margin-top:6px; }

.students-ghost-label{ height:1em; margin-bottom:6px; visibility:hidden; }


.students-grid{
  display:grid;
  grid-template-columns:repeat(5, minmax(0, 1fr));
  gap:10px;
  /* фиксируем высоту строки, чтобы все карточки были одинаковыми по высоте */
  grid-auto-rows: var(--student-card-h, 205px);
}

@media (max-width: 1400px){
  .students-grid{ grid-template-columns:repeat(4, minmax(0, 1fr)); }
}
@media (max-width: 1150px){
  .students-grid{ grid-template-columns:repeat(3, minmax(0, 1fr)); }
}
@media (max-width: 860px){
  .students-grid{ grid-template-columns:repeat(2, minmax(0, 1fr)); }
}
@media (max-width: 560px){
  .students-grid{ grid-template-columns:1fr; }
}
.student-card{
  cursor:pointer;
  padding:10px;
  height:100%;
  display:flex;
  flex-direction:column;
  /* не обрезаем контент (карточка стала выше, но лучше не резать) */
  overflow:visible;
  /* имя → класс: минимально, как перенос строки */
  --gap-name-class:2px;
  /* класс → блоки: фиксированный зазор (чтобы не зависел от --gap-name-class) */
  --gap-class-metrics:5px;
}

.student-title{
  font-size:16px;
  margin-bottom:var(--gap-name-class);
  line-height:1.2;
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
  /* min-height убрали: класс должен быть сразу под именем, если имя в одну строку */
}

.student-meta{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; min-height:1.2em; }
.student-metrics{
  display:grid;
  grid-template-columns:repeat(2, minmax(0, 1fr));
  gap:8px;
  margin-top:auto;
  padding-top: var(--gap-class-metrics);
}

.student-actions{
  display:flex;
  justify-content:flex-end;
  gap:8px;
  margin-top:10px;
}

.student-problem{
  border-color: rgba(220,38,38,.55);
  box-shadow: 0 0 0 2px rgba(220,38,38,.08);
}

.stat-mini{
  border:1px solid var(--border);
  border-radius:12px;
  padding:6px 8px;
  min-width:0;
  background: rgba(148,163,184,.08);
}

.stat-mini-label{ font-size:11px; color: var(--text-dim); margin-bottom:2px; }
.stat-mini-value{ font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

.stat-gray   { background: rgba(148,163,184,.10); }
.stat-green  { background: rgba(5,150,105,.12); border-color: rgba(5,150,105,.35); }
.stat-lime   { background: rgba(132,204,22,.14); border-color: rgba(132,204,22,.35); }
.stat-yellow { background: rgba(234,179,8,.14); border-color: rgba(234,179,8,.35); }
.stat-red    { background: rgba(220,38,38,.12); border-color: rgba(220,38,38,.35); }

/* ===== Patch 3A: умная тренировка (панель прогресса) ===== */
.smart-panel{
  margin: 10px 0 0;
  padding: 10px 12px;
  border:1px solid var(--border);
  border-radius:12px;
  background: rgba(148,163,184,.06);
}
.smart-panel.hidden{ display:none; }

.smart-row{ display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
.smart-title{ font-size:13px; color: var(--text); }
.smart-sub{ font-size:12px; color: var(--text-dim); }

.smart-tags{ display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
.smart-tag{
  font-size:12px;
  padding:4px 8px;
  border:1px solid var(--border);
  border-radius:999px;
  background: rgba(148,163,184,.08);
}

.smart-actions{ display:flex; gap:8px; }
.smart-actions button{ padding:6px 10px; border-radius:10px; }


/* ===== Patch 3C: умное ДЗ (рекомендации + план) ===== */

.err{ color: var(--danger); }

.smart-hw-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}

.smart-hw-panel{
  margin-top:10px;
  padding:12px;
  border:1px solid var(--border);
  border-radius:14px;
  background: rgba(148,163,184,.05);
}

.smart-tabs{
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap:wrap;
  margin: 2px 0 10px;
}

.smart-tab-btn{
  padding:8px 10px;
  border:1px solid var(--border);
  border-radius:999px;
  background: rgba(148,163,184,.04);
  color: var(--text);
  cursor:pointer;
}

.smart-tab-btn.is-active{
  background: var(--panel);
}

.smart-tab-content{ }

.smart-hw-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:12px;
  align-items:start;
}

@media (max-width: 860px){
  .smart-hw-grid{ grid-template-columns: 1fr; }
}

.smart-hw-subhead{
  font-size:12px;
  color: var(--text-dim);
  margin: 4px 0 8px;
}

.smart-hw-list{
  display:grid;
  gap:10px;
}

.smart-topic{
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
  background: rgba(148,163,184,.06);
}

.smart-topic .row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}

.smart-topic .name{
  font-size:14px;
}

.smart-topic .meta{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-top:6px;
}

.smart-topic .actions{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  align-items:center;
  justify-content:flex-end;
  margin-top:10px;
}

.smart-topic input[type="number"]{
  width: 70px;
  padding: 8px 10px;
  border: 1px solid var(--border);
  border-radius: 10px;
  background: var(--panel);
  color: var(--text);
}

.smart-hw-total{
  margin-top:10px;
  padding:8px 10px;
  border:1px dashed var(--border);
  border-radius:12px;
  background: rgba(148,163,184,.04);
  display:inline-block;
}

.smart-hw-toolbar{
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap:wrap;
  margin: 4px 0 10px;
}

.smart-hw-search,
.smart-hw-sort{
  padding: 8px 10px;
  border: 1px solid var(--border);
  border-radius: 10px;
  background: var(--panel);
  color: var(--text);
  font-size: 13px;
}

.smart-hw-search{ flex: 1; min-width: 170px; }
.smart-hw-sort{ min-width: 180px; }

.smart-hw-hint{
  font-size: 12px;
  color: var(--text-dim);
}

.smart-count-pill{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width:34px;
  padding: 4px 10px;
  border: 1px solid var(--border);
  border-radius: 999px;
  background: rgba(148,163,184,.05);
  color: var(--text);
  font-size: 13px;
}



/* profile: меню действий (шестерёнка) */
.profile-titlebar{display:flex;align-items:center;gap:10px;}
.profile-menu-wrap{position:relative;display:inline-flex;align-items:center;}
.profile-gear-btn{width:36px;min-width:36px;height:36px;padding:0;font-size:18px;line-height:1;}
.profile-menu{position:absolute;top:calc(100% + 8px);left:0;min-width:210px;background:var(--panel);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:6px;z-index:2600;}
.profile-menu-item{width:100%;display:block;text-align:left;border:none;background:transparent;box-shadow:none;padding:10px 12px;border-radius:10px;cursor:pointer;}
.profile-menu-item:hover{background:rgba(148,163,184,.12);}
.profile-menu-item:active{background:rgba(148,163,184,.18);}
.profile-menu-item:disabled{opacity:.55;cursor:not-allowed;}

/* profile: мобильная адаптация (не давать тексту вылезать за рамки) */
@media (max-width: 1024px){
  #profileGrid{
    grid-template-columns: clamp(110px, 34vw, 160px) 1fr !important;
  }
  #profileGrid > div{
    min-width:0;
    overflow-wrap:anywhere;
    word-break:break-word;
  }
  .profile-titlebar{
    flex-wrap:wrap;
    align-items:flex-start;
  }
  .profile-titlebar h1{
    min-width:0;
  }
}
@media (max-width: 520px){
  #profileGrid{
    grid-template-columns: 1fr !important;
    gap: 6px 0 !important;
  }
  #profileGrid > div:nth-child(2n+1){
    margin-top: 10px;
  }
}




/* ===== my_students: панель действий и модалка добавления ===== */
.students-head{display:flex;flex-direction:column;align-items:flex-start;gap:10px;}
.students-head-actions{display:flex;align-items:center;gap:10px;flex-wrap:wrap;}

/* небольшая модалка (добавление ученика) */
.modal-card.modal-sm{width:min(520px, calc(100vw - 24px));min-height:auto;}
.modal-body-simple{padding:12px 14px;display:flex;flex-direction:column;gap:12px;}
.modal-actions-simple{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;}

/* карточка ученика: шестерёнка и меню действий */
.student-head{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;}
.student-head .student-title{margin-bottom:0;}
.student-page-titlebar{display:flex;align-items:center;gap:10px;}
.student-page-titlebar h1{margin:0;}
.student-menu-wrap{position:relative;display:inline-flex;align-items:center;}
.student-gear-btn{width:36px;min-width:36px;height:36px;padding:0;font-size:18px;line-height:1;border-radius:12px;}
.student-menu{position:absolute;top:calc(100% + 8px);right:0;min-width:160px;background:var(--panel);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:6px;z-index:2600;}
.student-menu-item{width:100%;display:block;text-align:left;border:none;background:transparent;box-shadow:none;padding:10px 12px;border-radius:10px;cursor:pointer;}
.student-menu-item:hover{background:rgba(148,163,184,.12);}
.student-menu-item:active{background:rgba(148,163,184,.18);}
.student-menu-item:disabled{opacity:.55;cursor:not-allowed;}
/* --- Home student: badges layout hard-fix (2026-02-06) ---
   Цели:
   - убрать "наезд" бейджей (не полагаться на display:contents)
   - сделать фиксированный зазор 3ch от countbox до бейджей
   - уменьшить и стабилизировать вертикальный зазор "Процент/Покрытие" -> аккордеон
   - убрать рост зазоров при раскрытии (margin-top у .children)
*/
body[data-home-variant="student"] #accordion{
  --home-badge-w: 60px;          /* одинаковая ширина бейджей 1-го уровня */
  --home-badges-gap: 12px;       /* промежуток между % и покрытием */
}

/* grid: countbox | spacer(3ch) | badges | title | uniq */
body[data-home-variant="student"] #accordion .home-badges-head .row,
body[data-home-variant="student"] #accordion .node.section > .row{
  display:grid !important;
  grid-template-columns: max-content 3ch max-content 1fr max-content 1fr !important;
  column-gap: 0 !important;
  align-items: center !important;
}

/* вертикальные отступы: уменьшаем gap "Процент/Покрытие" -> первая строка */
body[data-home-variant="student"] #accordion .home-badges-head{
  padding: 2px 0 0 !important;
}
body[data-home-variant="student"] #accordion .node.section > .row{
  padding: 8px 0 !important;
}

/* countbox: не фиксируем ширину (иначе появляется огромный зазор) */
body[data-home-variant="student"] #accordion .home-badges-head .row > .countbox,
body[data-home-variant="student"] #accordion .node.section > .row > .countbox{
  grid-column: 1 !important;
  width: auto !important;
  margin-right: 0 !important;
}

/* бейджи/подписи в общей колонке + flex внутри (без display:contents) */
body[data-home-variant="student"] #accordion .home-badges-head .home-section-badges,
body[data-home-variant="student"] #accordion .node.section > .row > .home-section-badges{
  grid-column: 3 !important;
  display:flex !important;
  gap: var(--home-badges-gap) !important;
  align-items: center !important;
  margin-right: 0 !important;
}

/* подписи в шапке выравниваем по центру над бейджами */
body[data-home-variant="student"] #accordion .home-badges-head .home-badge-label{
  width: var(--home-badge-w) !important;
  min-width: var(--home-badge-w) !important;
  text-align: center !important;
  justify-self: auto !important;
}

/* бейджи 1-го уровня одинаковой ширины */
body[data-home-variant="student"] #accordion .home-section-pct,
body[data-home-variant="student"] #accordion .home-section-cov{
  width: var(--home-badge-w) !important;
  min-width: var(--home-badge-w) !important;
  justify-self: auto !important;
}

/* title / uniq */
body[data-home-variant="student"] #accordion .node.section > .row > .section-title{
  grid-column: 4 !important;
  margin-left: 0 !important;
}
body[data-home-variant="student"] #accordion .node.section > .row > .unique-btn{
  grid-column: 5 !important;
  margin-left: 0 !important;
}

body[data-home-variant="student"] #accordion .node.section > .row > .spacer{
  grid-column: 6 !important;
}


/* шапка: spacer занимает остаток строки (чтобы ничего не "плясало") */
body[data-home-variant="student"] #accordion .home-badges-head .row > .spacer{
  grid-column: 4 / -1 !important;
}

/* раскрытие: убираем верхний margin у списков, чтобы не "раздувало" расстояния при кликах */
body[data-home-variant="student"] #accordion .children{
  margin-top: 0 !important;
}
/* 2-й уровень: одинаковая ширина бейджа по самой широкой подписи */
body[data-home-variant="student"] #accordion .home-topic-badge{
  width: var(--home-topic-badge-w, auto) !important;
  min-width: var(--home-topic-badge-w, auto) !important;
}


/* --- Home student: spacing corrections (2026-02-06) ---
   Причины:
   1) в предыдущем фиксе для grid-строк был задан padding на .node.section > .row (увеличивал расстояние между темами);
   2) у блока заголовков и первой секции суммировались паддинги (давали большой зазор после "Процент/Покрытие").
*/
body[data-home-variant="student"] #accordion .node.section > .row{
  padding:0 !important;
}
body[data-home-variant="student"] #accordion .home-badges-head{
  padding:0 !important;
  margin:0 !important;
}
body[data-home-variant="student"] #accordion .home-badges-head .row{
  padding:0 !important;
}
body[data-home-variant="student"] #accordion .home-badges-head + .node.section{
  padding-top:6px !important;
}

/* --- Home student: tighter gaps v2 (2026-02-06) --- */
body[data-home-variant="student"] #accordion{
  --home-hgap: 1.5ch;
}

/* countbox | gap | badges | gap | title | uniq */
body[data-home-variant="student"] #accordion .node.section > .row,
body[data-home-variant="student"] #accordion .home-badges-head .row{
  grid-template-columns: max-content var(--home-hgap) max-content var(--home-hgap) 1fr max-content !important;
}

/* placements */
body[data-home-variant="student"] #accordion .node.section > .row > .countbox{grid-column:1 !important}
body[data-home-variant="student"] #accordion .node.section > .row > .home-section-badges{grid-column:3 !important}
body[data-home-variant="student"] #accordion .node.section > .row > .section-title{grid-column:5 !important}
body[data-home-variant="student"] #accordion .node.section > .row > .unique-btn{grid-column:6 !important}

body[data-home-variant="student"] #accordion .home-badges-head .row > .countbox{grid-column:1 !important}
body[data-home-variant="student"] #accordion .home-badges-head .row > .home-section-badges-head{grid-column:3 !important}
body[data-home-variant="student"] #accordion .home-badges-head .row > .spacer{grid-column:5 / -1 !important}

/* less vertical gap: controls -> accordion and labels -> first row */
body[data-home-variant="student"] #picker .accordion{margin-top:4px !important}
body[data-home-variant="student"] #accordion .home-badges-head{padding:0 0 1px !important}
body[data-home-variant="student"] #accordion .home-badges-head .row{padding:1px 0 0 0 !important}


/* --- Home student: tighter labels gap + section title outline (2026-02-06) --- */
body[data-home-variant="student"] #accordion .home-badges-head{
  padding-bottom:0 !important;
  margin-bottom:0 !important;
}
/* gap between "Процент/Покрытие" row and the first section */
body[data-home-variant="student"] #accordion .home-badges-head + .node.section{
  padding-top:3px !important;
}

/* top-level section title: restore outlined button sized to text */
body[data-home-variant="student"] #accordion .node.section > .row > .section-title{
  border:1px solid var(--border) !important;
  border-radius:14px !important;
  padding:6px 10px !important;
  background:rgba(148,163,184,.06) !important;
  width:fit-content !important;
  max-width:100% !important;
  justify-self:start !important;
  box-sizing:border-box !important;
}


/* --- Home student: fix vertical gaps + compact outlined section titles (2026-02-06b) --- */
body[data-home-variant="student"] #accordion .home-badges-head{
  padding:0 !important;
  margin:0 !important;
}
body[data-home-variant="student"] #accordion .home-badges-head .row{
  padding:0 !important;
  margin:0 !important;
}
/* minimize gap between "Процент/Покрытие" row and the first section */
body[data-home-variant="student"] #accordion .home-badges-head + .node.section{
  padding-top:0 !important;
}

/* outlined section title sized to text, but compact (do not increase row spacing) */
body[data-home-variant="student"] #accordion .node.section > .row > .section-title{
  border:1px solid var(--border) !important;
  border-radius:12px !important;
  padding:2px 8px !important;
  background:transparent !important;
  line-height:1.2 !important;
}


/* home_student: панель прототипов справа */
body[data-home-variant="student"] #picker .node.topic .title{
  cursor:pointer;
}
body[data-home-variant="student"] #picker .node.topic .title:hover{
  text-decoration:underline;
}

body[data-home-variant="student"].home-protos-open #picker .picker-right{
  flex:0 0 520px;
  width:520px;
}

body[data-home-variant="student"] #homeProtoPanel{
  margin-top:12px;
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  background:rgba(148,163,184,.06);
}
body[data-home-variant="student"] #homeProtoPanel .home-proto-head{
  display:flex;
  flex-direction:column;
  gap:6px;
  margin-bottom:10px;
}
body[data-home-variant="student"] #homeProtoPanel .home-proto-title{
  font-size:14px;
  font-weight:600;
  line-height:1.25;
}
body[data-home-variant="student"] #homeProtoPanel .home-proto-note{
  font-size:12px;
  opacity:.8;
  line-height:1.3;
}

body[data-home-variant="student"] #homeProtoList{
  display:flex;
  flex-direction:column;
  gap:10px;
  max-height:calc(100vh - 220px);
  overflow:auto;
  padding-right:2px;
}

/* home_student: уменьшенный степпер в мини-карточках прототипов (на ~20% компактнее) */
body[data-home-variant="student"] #homeProtoPanel .tp-item-right{ gap:6px; }
body[data-home-variant="student"] #homeProtoPanel .tp-ctr-btn{
  width:26px;
  height:26px;
  border-radius:8px;
  font-size:14px;
  padding:0 0 2px 0;
}
body[data-home-variant="student"] #homeProtoPanel .tp-ctr-val{
  width:22px;
  min-width:22px;
  height:26px;
  padding:0;
  border:none;
  background:transparent;
  font-size:14px;
  line-height:26px;
  text-align:center;
  box-sizing:border-box;
  display:inline-block;
}
body[data-home-variant="student"] #homeProtoPanel .tp-ctr-cap{
  font-size:10px;
  white-space:nowrap;
}
