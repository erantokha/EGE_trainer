<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚Äî –ê–¥–º–∏–Ω–∫–∞</title>
  <link rel="stylesheet" href="./admin.css">
  <!-- Chart.js (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
</head>
<body>
  <div class="wrap">
    <header class="header">
      <div class="brand">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
      <div class="header-actions">
        <span id="authStatus" class="pill pill-muted">–ì–æ—Å—Ç—å</span>
        <button id="btnSignIn" class="btn secondary">–í–æ–π—Ç–∏</button>
        <button id="btnSignOut" class="btn danger hidden">–í—ã–π—Ç–∏</button>
      </div>
    </header>

    <!-- –ë–ª–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ e-mail (magic link) -->
    <section id="authBlock" class="panel">
      <h2>–í—Ö–æ–¥ –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π</h2>
      <p class="muted">–£–∫–∞–∂–∏—Ç–µ e-mail, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–¥—ë—Ç —Å—Å—ã–ª–∫–∞ –≤—Ö–æ–¥–∞ (magic link).</p>
      <div class="row auth-row">
        <input id="email" type="email" placeholder="name@school.ru" class="input" />
        <button id="sendMagic" class="btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
      </div>
      <p id="authHint" class="muted"></p>
    </section>

    <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
    <section id="filters" class="panel hidden">
      <div class="row">
        <div class="field">
          <label>–° –¥–∞—Ç—ã</label>
          <input id="fromDate" type="date" class="input">
        </div>
        <div class="field">
          <label>–ü–æ –¥–∞—Ç—É</label>
          <input id="toDate" type="date" class="input">
        </div>
        <div class="field">
          <label>–¢–µ–º–∞</label>
          <input id="topic" type="text" class="input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: cylinder">
        </div>
        <div class="field">
          <label>–†–µ–∂–∏–º</label>
          <select id="mode" class="input">
            <option value="">–õ—é–±–æ–π</option>
            <option value="practice">–£—á–µ–±–Ω—ã–π</option>
            <option value="exam">–≠–∫–∑–∞–º–µ–Ω</option>
          </select>
        </div>
        <div class="field grow">
          <label>–ü–æ–∏—Å–∫</label>
          <input id="q" type="text" class="input" placeholder="–∏–º—è, e-mail –∏–ª–∏ ID —É—á–µ–Ω–∏–∫–∞">
        </div>
        <div class="field" style="align-self:flex-end">
          <button id="apply" class="btn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        </div>
      </div>
      <div class="row" style="gap:10px;margin-top:8px">
        <button id="exportCSV" class="btn secondary">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
        <button id="exportJSON" class="btn secondary">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
        <span id="countInfo" class="pill pill-muted">‚Äî</span>
      </div>
    </section>

    <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
    <section id="charts" class="panel hidden">
      <h3>–û–±–∑–æ—Ä</h3>
      <div class="grid">
        <div class="card">
          <h4>–¢–æ—á–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º</h4>
          <canvas id="accuracyLine"></canvas>
        </div>
        <div class="card">
          <h4>–¢–æ—á–Ω–æ—Å—Ç—å –ø–æ —Ç–µ–º–∞–º</h4>
          <canvas id="topicsBar"></canvas>
        </div>
      </div>
    </section>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ø—ã—Ç–æ–∫ -->
    <section id="tableSection" class="panel hidden">
      <div class="table-wrap">
        <table class="table" id="attemptsTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>–£—á–µ–Ω–∏–∫</th>
              <th>E-mail</th>
              <th>–¢–µ–º—ã</th>
              <th>–†–µ–∂–∏–º</th>
              <th>–í–µ—Ä–Ω–æ</th>
              <th>–í—Å–µ–≥–æ</th>
              <th>%</th>
              <th>–°—Ä–µ–¥–Ω–µ–µ</th>
              <th>–î–ª–∏—Ç.</th>
              <th>–î–∞—Ç–∞</th>
            </tr>
          </thead>
          <tbody id="attemptsBody"></tbody>
        </table>
      </div>
      <div class="row pager">
        <button id="prevPage" class="btn secondary">–ù–∞–∑–∞–¥</button>
        <span id="pageInfo" class="muted">1 / 1</span>
        <button id="nextPage" class="btn secondary">–í–ø–µ—Ä—ë–¥</button>
        <select id="pageSize" class="input">
          <option value="10">10</option>
          <option value="25" selected>25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
      </div>
    </section>

    <footer class="footer">
      <a href="../public/" target="_blank">‚Üó –û—Ç–∫—Ä—ã—Ç—å —Ç—Ä–µ–Ω–∞–∂—ë—Ä</a>
    </footer>
  </div>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- –ù–∞—à –∫–æ–¥ -->
  <script type="module" src="./admin.js"></script>
</body>
</html>
